!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.GdWebCanaryClient=e():t.GdWebCanaryClient=e()}(self,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>S});var n="__xhr_gd_ajax_hook",r=["load","loadend","timeout","error","readystatechange","abort"];function i(t,e){var n={};for(var r in t)n[r]=t[r];return n.target=n.currentTarget=e,n}const o=`${n}_QUEUE`;function s(t){return function(e,n){const r=window[o].filter((e=>e[t])),i=r.length;let s=0;const a=()=>{s++,s===i&&n.next(e)};if(i)for(let n=0;n<r.length;n++)(0,r[n][t])(e,{next:a});else n.next(e)}}void 0===window[o]&&(window[o]=[]);var a=r[0],c=r[1],u=r[2],h=r[3],p=r[4],f=r[5];function d(t,e){if(e=e||window,window[o].push(t),!e[n])return function(t){var e=s("onRequest"),o=s("onResponse"),a=s("onError");function c(){return!0}function d(t){return function(e,n){return function(t,e,n,r){var i=new b(t);n={config:t.config,error:n,type:r},a?a(n,i):i.next(n)}(e,0,n,t),!0}}function y(t,e){return 4===t.readyState&&0!==t.status?function(t,e){var n=new x(t),r={response:e.response||e.responseText,status:e.status,statusText:e.statusText,config:t.config,headers:t.resHeader||t.getAllResponseHeaders().split("\r\n").reduce((function(t,e){if(""===e)return t;var n=e.split(":");return t[n.shift()]=function(t){return t.replace(/^\s+|\s+$/g,"")}(n.join(":")),t}),{})};if(!o)return n.resolve(r);o(r,n)}(t,e):4!==t.readyState&&g(t,p),!0}return function(t,e){(e=e||window)[n]=e[n]||e.XMLHttpRequest,e.XMLHttpRequest=function(){for(var t=new e[n],i=0;i<r.length;++i){var c="on"+r[i];void 0===t[c]&&(t[c]=null)}for(var u in t){var h="";try{h=typeof t[u]}catch(t){}"function"===h?this[u]=a(u):"xhr"!==u&&Object.defineProperty(this,u,{get:o(u),set:s(u),enumerable:!0})}var p=this;t.getProxy=function(){return p},this.xhr=t};try{Object.assign(e.XMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4})}catch(t){}function o(e){return function(){var n=this.hasOwnProperty(e+"_")?this[e+"_"]:this.xhr[e],r=(t[e]||{}).getter;return r&&r(n,this)||n}}function s(e){return function(n){var r=this.xhr,o=this,s=t[e];if("on"===e.substring(0,2))o[e+"_"]=n,r[e]=function(s){s=i(s,o),t[e]&&t[e].call(o,r,s)||n.call(o,s)};else{var a=(s||{}).setter;n=a&&a(n,o)||n,this[e+"_"]=n;try{r[e]=n}catch(t){}}}}function a(e){return function(){var n=[].slice.call(arguments);if(t[e]){var r=t[e].call(this,n,this.xhr);if(r)return r}return this.xhr[e].apply(this.xhr,n)}}return e[n]}({onload:c,onloadend:c,onerror:d(h),ontimeout:d(u),onabort:d(f),onreadystatechange:function(t){return y(t,this)},open:function(t,n){var r=this,i=n.config={headers:{}};i.method=t[0],i.url=t[1],i.async=t[2],i.user=t[3],i.password=t[4],i.xhr=n;var o="on"+p;if(n[o]||(n[o]=function(){return y(n,r)}),e)return!0},send:function(t,n){var r=n.config;if(r.withCredentials=n.withCredentials,r.body=t[0],e){var i=function(){e(r,new m(n))};return!1===r.async?i():setTimeout(i),!0}},setRequestHeader:function(t,n){if(n.config.headers[t[0].toLowerCase()]=t[1],e)return!0},addEventListener:function(t,e){var n=this;if(-1!==r.indexOf(t[0])){var o=t[1];return l(e).addEventListener(t[0],(function(e){var r=i(e,n);r.type=t[0],r.isTrusted=!0,o.call(n,r)})),!0}},getAllResponseHeaders:function(t,e){var n=e.resHeader;if(n){var r="";for(var i in n)r+=i+": "+n[i]+"\r\n";return r}},getResponseHeader:function(t,e){var n=e.resHeader;if(n)return n[(t[0]||"").toLowerCase()]}},t)}(e)}function l(t){return t.watcher||(t.watcher=document.createElement("a"))}function g(t,e){var n,r=t.getProxy(),o="on"+e+"_",s=i({type:e},r);r[o]&&r[o](s),"function"==typeof Event?n=new Event(e,{bubbles:!1}):(n=document.createEvent("Event")).initEvent(e,!1,!0),l(t).dispatchEvent(n)}function y(t){this.xhr=t,this.xhrProxy=t.getProxy()}function v(t){function e(t){y.call(this,t)}return e.prototype=Object.create(y.prototype),e.prototype.next=t,e}y.prototype=Object.create({resolve:function(t){var e=this.xhrProxy,n=this.xhr;e.readyState=4,n.resHeader=t.headers,e.response=e.responseText=t.response,e.statusText=t.statusText,e.status=t.status,g(n,p),g(n,a),g(n,c)},reject:function(t){this.xhrProxy.status=0,g(this.xhr,t.type),g(this.xhr,c)}});var m=v((function(t){var e=this.xhr;for(var n in t=t||e.config,e.withCredentials=t.withCredentials,e.open(t.method,t.url,!1!==t.async,t.user,t.password),t.headers)e.setRequestHeader(n,t.headers[n]);e.send(t.body)})),x=v((function(t){this.resolve(t)})),b=v((function(t){this.reject(t)})),w=function(){return w=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},w.apply(this,arguments)},E=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},O="x-abtest-tags",j=["localhost","127.0.0.1","0.0.0.0",".gaoding.com",".uupoop.com",".h5gdsvip.com",".h5gdvip.com",".h5gd.com",".xsbapp.com",".fococlipping.com",".hlgdata.com",".ttxsapp.com",".qingzhan.com",".focodesign.com",".dadanxia.net",".huanleguang.com",".qiping.com",".yunjian.com",".qingzhan.com",".pszhuli.com",".xsbapp.com",".huaban.com",".huabanpro.com",".huabanimg.com",".cowtransfer.cn",".cowtransfer.com",".insmind.com"],C=["insmind-gdesign-dam-use-fat.upload.insmind.com","insmind-gdesign-dam-use-stage.upload.insmind.com","insmind-gdesign-dam-use.upload.insmind.com","insmind-gdesign-dam-use-fat.insmind.com","insmind-gdesign-dam-use-stage.insmind.com","insmind-gdesign-dam-use.insmind.com"];const S=new(function(){function t(){this.abExperimentSign=null,this.abExperimentFuzzyPath=[],this.cacheCookie="",this.canaryOpts=null,this.cacheCookie=document.cookie,this.whiteList=E([],j,!0),this.blacklist=E([],C,!0),this.canaryOpts=this.getCanaryOption(),this.proxyXhr(),this.proxyFetch()}return t.prototype.proxyXhr=function(){var t=this;d({onRequest:function(e,n){var r=t.isIncludesWhiteUrl(e.url);if(r){var i=t.getAbTagsOptions(r);(t.canaryOpts||i)&&Object.assign(e.headers,t.canaryOpts,i),n.next(e)}else n.next(e)},onError:function(t,e){e.next(t.error)},onResponse:function(t,e){e.next(t)}}),Object.assign(XMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4})},t.prototype.proxyFetch=function(){var t=this,e=window.fetch;window.fetch=function(n,r){var i=n instanceof Request?n.url:n,o=t.isIncludesWhiteUrl(i);if(!o)return e.apply(window,[n,r]);var s=t.getAbTagsOptions(o);return(t.canaryOpts||s)&&((r=r||{}).headers=w(w(w({},r.headers||{}),t.canaryOpts),s)),e.apply(window,[n,r])}},t.prototype.getCanaryOption=function(){var t=this.getCanaryForceVersion()||this.getCanaryVersion(),e=this.getProjectEnvVersion(),n=this.getProductType(),r={};return t&&(r["x-gd-traffic-tags"]=t),e&&(r["x-gd-project-env"]=e),n&&(r["x-product-type"]=n),Object.keys(r).length?r:void 0},t.prototype.getAbTagsOptions=function(t){var e,n,r,i;try{if(!this.abExperimentSign||!Object.keys(this.abExperimentSign).length){var o=Object.keys(window.localStorage).filter((function(t){return t.startsWith("ABTEST_")}));this.abExperimentSign=o.reduce((function(t,e){try{var n=window.localStorage.getItem(e);if(!n)return t;var r=JSON.parse(n);return w(w({},t),r.experimentSign)}catch(e){return t}}),{}),this.abExperimentFuzzyPath=Object.keys(this.abExperimentSign).filter((function(t){return t.endsWith("*")}))}var s=t.pathname,a=null===(i=null===(r=this.abExperimentSign)||void 0===r?void 0:r[s])||void 0===i?void 0:i.sign;if(a)return(e={})[O]=a,e;var c=this.abExperimentFuzzyPath.find((function(t){return s.startsWith(t.slice(0,-1))}));return c?((n={})[O]=this.abExperimentSign[c].sign,n):null}catch(t){}},t.prototype.getCanaryVersion=function(){var t=this.getCookie("canary");if(t){var e=t.split("?"),n=e[0],r=e[1];return(location.host+location.pathname).includes(n)?r:void 0}},t.prototype.getCanaryForceVersion=function(){return this.getCookie("canary_force")},t.prototype.getProjectEnvVersion=function(){return this.getCookie("project_env")},t.prototype.getProductType=function(){return this.getCookie("x-product-type")},t.prototype.getCookie=function(t){for(var e=t+"=",n=this.cacheCookie.split(";"),r=0;r<n.length;r++){var i=n[r].trim();if(0==i.indexOf(e))return i.substring(e.length,i.length)}},t.prototype.setWhiteList=function(t,e){"string"==typeof t&&this.whiteList.push(t),Array.isArray(t)&&(this.whiteList=this.whiteList.concat(t)),e&&"string"==typeof t&&(this.whiteList=[t]),e&&Array.isArray(t)&&(this.whiteList=E([],t,!0))},t.prototype.setBlackList=function(t,e){"string"==typeof t&&this.blacklist.push(t),Array.isArray(t)&&(this.blacklist=this.blacklist.concat(t)),e&&"string"==typeof t&&(this.blacklist=[t]),e&&Array.isArray(t)&&(this.blacklist=E([],t,!0))},t.prototype.isIncludesWhiteUrl=function(t){if("string"==typeof t&&!/\.(png|jpg|jpeg|svg|bmp|gif|js|css|mjs|mp4|avi|pdf|mp3|ppt|pptx|xlt|xltx|doc|docx|csv|wat|wasm|otf|ttf|woff|woff2|json|bpm|tiff|psd|ai|esp|webp|heic|ico|cur|pict|zip|sql|db|rar)(\?.*)?$/i.test(t)){var e=t;if(t.startsWith("/")&&!t.startsWith("//")&&(e="".concat(location.origin).concat(t)),t.startsWith("//")&&(e="".concat(location.protocol).concat(t)),/^http(s)?:\/\//.test(e))try{var n=new URL(e),r=n.hostname;if(this.domainMatch(this.blacklist,r))return;if(this.domainMatch(this.whiteList,r))return n}catch(t){}}},t.prototype.domainMatch=function(t,e){void 0===t&&(t=[]);for(var n=0;n<t.length;n++){var r=t[n];if(r.startsWith(".")){if(e.endsWith(r))return!0}else if(r===e)return!0}return!1},t}());return e})()));